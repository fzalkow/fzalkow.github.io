<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Twelve Tone Row Tables with Common Lisp, LilyPond, and LaTeX | Frank Zalkow</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (de)" hreflang="de" href="../de/rss.xml">
<link rel="canonical" href="https://www.frank-zalkow.de/twelve-tone-row-table-with-common-lisp-lilypond-and-latex/">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet">
<link rel="stylesheet" href="../assets/style.css">
<style>
body {font-size: 18px;font-family: 'Inter', sans-serif;}
h1 a {color: inherit; text-decoration: none;}
h1 a:visited {color: inherit;}
h1 a:hover {color: inherit;}
.publication a.btn {padding: 2px 5px; margin-right: 5px;}
</style>
<meta name="author" content="Frank Zalkow">
<meta property="og:site_name" content="Frank Zalkow">
<meta property="og:title" content="Twelve Tone Row Tables with Common Lisp, LilyPond, and LaTeX">
<meta property="og:url" content="https://www.frank-zalkow.de/twelve-tone-row-table-with-common-lisp-lilypond-and-latex/">
<meta property="og:description" content="48 rows can be created from a single twelve-tone row: the prime, retrograde, inversion and the retrograde inversion with 12 transpositions each. Here I show how to make nice tables of these 48 transfo">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-08-07T00:00:00+02:00">
<link rel="alternate" hreflang="de" href="../de/twelve-tone-row-table-with-common-lisp-lilypond-and-latex/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.frank-zalkow.de/">

                <span id="blog-title">Frank Zalkow</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../about-me/">About Me</a>
                </li>
<li>
<a href="../publications/">Publications</a>
                </li>
<li>
<a href="../teaching/">Teaching</a>
                </li>
<li>
<a href="../contact/">Contact</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
                        </li>
<li><a href="https://www.linkedin.com/in/frank-zalkow" target="_blank"><i class="fa fa-linkedin"></i></a></li>
                        <li><a href="https://github.com/fzalkow" target="_blank"><i class="fa fa-github"></i></a></li>
                        <li><a href="https://stackoverflow.com/users/2812618/frank-zalkow" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
                        
            <li><a href="https://www.frank-zalkow.de/de/" rel="alternate" hreflang="de">Deutsch</a></li>

                    
                
                

            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Twelve Tone Row Tables with Common Lisp, LilyPond, and LaTeX</a></h1>

        
        <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">Also available in:</h3>
                <p><a href="../de/twelve-tone-row-table-with-common-lisp-lilypond-and-latex/" rel="alternate" hreflang="de">Deutsch</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>48 rows can be created from a single twelve-tone row: the prime, retrograde, inversion and the retrograde inversion with 12 transpositions each. Here I show how to make nice tables of these 48 transformations. For example the row of Arnold Schönbergs <em>Variations for Orchestra</em> op. 31:</p>
<div style="text-align:center">
  <a href="../media/row_schoenberg.pdf">
    <img src="../images/row_schoenberg.jpg"></a>
</div>

<p>In the following an old version is described, which uses LilyPond and LaTeX. A new version, which only depends on LilyPond, is to be found on <a href="https://github.com/fzalkow/12tone-table">GitHub</a>. There is also to be found an executable, which doesn't require any Common Lisp implementation.</p>
<p>A Common Lisp Implementation is needed (I use LispWorks) and ASDF must be available. It only works on platforms with Shell like Max OSX or Unix, because the communication with the operating system is done via asdf:run-shell-command.</p>
<p>The paths to LilyPond, pdflatex as well as the twelve-tone row can be adjusted in the first few lines of the code. The note names of the row must be the English names for natural tones (c d e f g a b) with is resp. es for sharp or flat. (E.g. that means E♭ must be notated as ees.)</p>
<p>Concerning questions, remarks or whatever: You can <a href="../en/about-me.html">conctact me</a>!</p>
<div class="code"><pre class="code literal-block"><span class="c1">;;; -*- mode: Common-Lisp; Base: 10 ; Syntax: ANSI-Common-Lisp ; coding: utf-8 -*-</span>
<span class="c1">;;; make 12 tone row table pdf files with LilyPond and LaTeX</span>
<span class="c1">;;; This work is licensed under a Creative Commons Attribution 3.0 Unported License.</span>
<span class="c1">;;; Frank Zalkow, 2010-2013</span>

<span class="c1">;; adjust these paths to your needs</span>
<span class="p">(</span><span class="nb">defparameter</span><span class="w"> </span><span class="vg">*row*</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nv">bes</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">ges</span><span class="w"> </span><span class="nv">ees</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nb">cis</span><span class="w"> </span><span class="nv">g</span><span class="w"> </span><span class="nv">gis</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defparameter</span><span class="w"> </span><span class="vg">*lilypond*</span><span class="w"> </span><span class="s">"/Applications/LilyPond/LilyPond.app"</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defparameter</span><span class="w"> </span><span class="vg">*pdflatex*</span><span class="w"> </span><span class="s">"/usr/texbin/pdflatex"</span><span class="p">)</span>

<span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="c1">;; ASDF</span>
<span class="p">(</span><span class="nb">require</span><span class="w"> </span><span class="ss">'asdf</span><span class="p">)</span>
<span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nb">find-package</span><span class="w"> </span><span class="ss">'asdf</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">"ASDF is not installed!"</span><span class="p">))</span>
<span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span class="c1">;; ARBITRARY NOTE NAMES TO NOTE NUMBERS</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">name2number</span><span class="w"> </span><span class="p">(</span><span class="nv">note</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nv">diatonic</span><span class="w"> </span><span class="o">'</span><span class="p">((</span><span class="s">"c"</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="s">"d"</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="s">"e"</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="s">"f"</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="s">"g"</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="s">"a"</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="s">"b"</span><span class="w"> </span><span class="mi">11</span><span class="p">)))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">notestr</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">note</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">nr</span><span class="w"> </span><span class="p">(</span><span class="nb">cadr</span><span class="w"> </span><span class="p">(</span><span class="nb">nth</span>
<span class="w">                    </span><span class="p">(</span><span class="nb">position</span><span class="w"> </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="nv">notestr</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nv">diatonic</span><span class="w"> </span><span class="ss">:test</span><span class="w"> </span><span class="nf">#'</span><span class="nb">string-equal</span><span class="w"> </span><span class="ss">:key</span><span class="w"> </span><span class="nf">#'</span><span class="nb">car</span><span class="p">)</span>
<span class="w">                    </span><span class="nv">diatonic</span><span class="p">))))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">dotimes</span><span class="w"> </span><span class="p">(</span><span class="nv">i</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="nv">notestr</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="nv">nr</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">substr</span><span class="w"> </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="nv">notestr</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">i</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">i</span><span class="p">)))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">nr</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">nr</span><span class="w"> </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">string-equal</span><span class="w"> </span><span class="nv">substr</span><span class="w"> </span><span class="s">"is"</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                             </span><span class="p">((</span><span class="nb">string-equal</span><span class="w"> </span><span class="nv">substr</span><span class="w"> </span><span class="s">"es"</span><span class="p">)</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">                             </span><span class="p">(</span><span class="no">T</span><span class="w"> </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="nv">note</span><span class="w"> </span><span class="s">" is not a valid note name!"</span><span class="p">))))))))))</span>

<span class="c1">;; ROW MANIPULATIONS: transpositions, retrograde, inversion, retrograde-inversion</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">transposition</span><span class="w"> </span><span class="p">(</span><span class="nv">row</span><span class="w"> </span><span class="nv">interval</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">mod</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">interval</span><span class="p">)</span><span class="w"> </span><span class="mi">12</span><span class="p">))</span><span class="w"> </span><span class="nv">row</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">retrograde</span><span class="w"> </span><span class="p">(</span><span class="nv">row</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">reverse</span><span class="w"> </span><span class="nv">row</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">inversion</span><span class="w"> </span><span class="p">(</span><span class="nv">row</span><span class="w"> </span><span class="k">&amp;aux</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">row</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">mapcar</span>
<span class="w">   </span><span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="p">)</span>
<span class="w">       </span><span class="p">(</span><span class="nb">mod</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nb">first</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"> </span><span class="nb">first</span><span class="p">)</span><span class="w"> </span><span class="mi">12</span><span class="p">))</span>
<span class="w">   </span><span class="nv">row</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">retrograde-inversion</span><span class="w"> </span><span class="p">(</span><span class="nv">row</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">retrograde</span><span class="w"> </span><span class="p">(</span><span class="nv">inversion</span><span class="w"> </span><span class="nv">row</span><span class="p">)))</span>

<span class="c1">;; GENERATING CODE FOR LILYBOOK</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">generate-code</span><span class="w"> </span><span class="p">(</span><span class="nv">row-name</span><span class="w"> </span><span class="k">&amp;optional</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="no">T</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">row-nr</span><span class="w"> </span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#'</span><span class="nv">name2number</span><span class="w"> </span><span class="nv">row-name</span><span class="p">)))</span>
<span class="w">    </span><span class="c1">; converting a list of note numbers into a lilypond string</span>
<span class="w">    </span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">row2str</span><span class="w"> </span><span class="p">(</span><span class="nv">row</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">notes</span><span class="w"> </span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#'</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="p">)</span>
<span class="w">                                        </span><span class="p">(</span><span class="nb">nth</span><span class="w"> </span><span class="p">(</span><span class="nb">position</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">row-nr</span><span class="p">)</span><span class="w"> </span><span class="nv">row-name</span><span class="p">))</span>
<span class="w">                                    </span><span class="nv">row</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="nb">string-downcase</span>
<span class="w">                  </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span>
<span class="w">                               </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">notes</span><span class="p">))</span><span class="w"> </span><span class="s">"'4 "</span>
<span class="w">                               </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="s">"~{~a' ~}"</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">notes</span><span class="p">)))))))</span>

<span class="w">      </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"\\documentclass[landscape]{article}~%\\usepackage{array}~%\\usepackage{geometry}~%\\geometry{a4paper,left=10mm,right=10mm, top=10mm, bottom=10mm} ~%~%\\begin{document}~%~%\\begin{center}~%\\thispagestyle{empty}~%~%\\Large \\textsc{Twelve-tone-row table}\\\\[2cm] \\normalsize~%~%\\newcolumntype{C}{&gt;{\\centering\\arraybackslash} m{6cm}}~%\\newcolumntype{D}{&gt;{\\centering\\arraybackslash} m{0.5cm}}~%\\begin{tabular}{|D|CCCC|}\\hline~% &amp; prime &amp; retrograde &amp; inversion &amp; retrograde-inversion\\\\ \\hline~%"</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">dotimes</span><span class="w"> </span><span class="p">(</span><span class="nv">transp</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"~d &amp; "</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">transp</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">dolist</span><span class="w"> </span><span class="p">(</span><span class="nv">func</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="nv">retrograde</span><span class="w"> </span><span class="nv">inversion</span><span class="w"> </span><span class="nv">retrograde-inversion</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"\\begin{lilypond}[fragment,staffsize=12]~%"</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"#(set-accidental-style 'dodecaphonic)~%\\override Staff.TimeSignature #'stencil = ##f~%\\override Stem #'transparent = ##t~%\\cadenzaOn~%"</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="p">(</span><span class="nv">row2str</span><span class="w"> </span><span class="p">(</span><span class="nv">transposition</span><span class="w"> </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="nv">row-nr</span><span class="p">)</span><span class="w"> </span><span class="nv">transp</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"~%\\end{lilypond} "</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nb">eql</span><span class="w"> </span><span class="nv">func</span><span class="w"> </span><span class="ss">'retrograde-inversion</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">" &amp; ~%"</span><span class="p">)))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"\\\\ \\hline~%"</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="s">"\\end{tabular}~%\\end{center}~%\\end{document}"</span><span class="p">))))</span>

<span class="c1">;; ADDING A STRING TO AN ENVIRONMENT VARIABLE FOR DIFFERENT LISP IMPLEMENTATIONS</span>
<span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">add-env-path</span><span class="w"> </span><span class="p">(</span><span class="nb">pathname</span><span class="w"> </span><span class="k">&amp;optional</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="s">"PATH"</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">env</span>
<span class="w">         </span><span class="o">#+</span><span class="nv">LISPWORKS</span><span class="w"> </span><span class="o">`</span><span class="p">(</span><span class="nv">lispworks:environment-variable</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="p">)</span>
<span class="w">         </span><span class="o">#+</span><span class="nv">CMU</span><span class="w">       </span><span class="o">`</span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="p">(</span><span class="nb">assoc</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="w"> </span><span class="nv">ext:*environment-list*</span><span class="w"> </span><span class="ss">:test</span><span class="w"> </span><span class="nf">#'</span><span class="nb">string=</span><span class="p">))</span>
<span class="w">         </span><span class="o">#+</span><span class="nv">Allegro</span><span class="w">   </span><span class="o">`</span><span class="p">(</span><span class="nv">sys:getenv</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="p">)</span>
<span class="w">         </span><span class="o">#+</span><span class="nv">CLISP</span><span class="w">     </span><span class="o">`</span><span class="p">(</span><span class="nv">ext:getenv</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="p">)</span>
<span class="w">         </span><span class="o">#+</span><span class="nv">ECL</span><span class="w">       </span><span class="o">`</span><span class="p">(</span><span class="nv">si:getenv</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="p">)</span>
<span class="w">         </span><span class="o">#+</span><span class="nv">SBCL</span><span class="w">      </span><span class="o">`</span><span class="p">(</span><span class="nv">sb-unix::posix-getenv</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="p">)</span>
<span class="w">         </span><span class="p">))</span>
<span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="o">,</span><span class="nb">pathname</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nb">string=</span><span class="w"> </span><span class="o">,</span><span class="nb">pathname</span><span class="w"> </span><span class="s">""</span><span class="p">)))</span>
<span class="w">         </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="o">,</span><span class="nv">env</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="o">,</span><span class="nv">env</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">,</span><span class="nb">pathname</span><span class="p">))</span>
<span class="w">       </span><span class="o">,</span><span class="nv">env</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">double-tilde</span><span class="w"> </span><span class="p">(</span><span class="nv">str</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">substitute</span><span class="w"> </span><span class="s">"~"</span><span class="w"> </span><span class="s">"~~"</span><span class="w"> </span><span class="nv">str</span><span class="p">))</span>

<span class="c1">;; EXECUTE SHELL COMMANDS AND CREATE PDF</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">create-pdf</span><span class="w"> </span><span class="p">(</span><span class="nv">row</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nv">tempdir</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="s">"/tmp/twelve-tone-row-table-"</span><span class="w"> </span><span class="p">(</span><span class="nb">write-to-string</span><span class="w"> </span><span class="p">(</span><span class="nb">random</span><span class="w"> </span><span class="mi">9999999999</span><span class="p">))</span><span class="w"> </span><span class="s">"/"</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">lytex-file</span><span class="w"> </span><span class="p">(</span><span class="nb">merge-pathnames</span><span class="w"> </span><span class="nv">tempdir</span><span class="w"> </span><span class="s">"myrowtable.lytex"</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">tex-file</span><span class="w"> </span><span class="p">(</span><span class="nb">merge-pathnames</span><span class="w"> </span><span class="nv">tempdir</span><span class="w"> </span><span class="s">"myrowtable.tex"</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">pdf-file</span><span class="w"> </span><span class="p">(</span><span class="nb">merge-pathnames</span><span class="w"> </span><span class="nv">tempdir</span><span class="w"> </span><span class="s">"myrowtable.pdf"</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">lilybook</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="vg">*lilypond*</span><span class="w"> </span><span class="s">"/Contents/Resources/bin/lilypond-book"</span><span class="p">)))</span>
<span class="w">    </span><span class="c1">; if pdflatex directory is not in path environment, add it</span>
<span class="w">    </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nv">pdflatex-dir/</span><span class="w"> </span><span class="p">(</span><span class="nb">directory-namestring</span><span class="w"> </span><span class="vg">*pdflatex*</span><span class="p">))</span>
<span class="w">           </span><span class="p">(</span><span class="nv">pdflatex-dir</span><span class="w"> </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="nv">pdflatex-dir/</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="nv">pdflatex-dir/</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nb">search</span><span class="w"> </span><span class="nv">pdflatex-dir</span><span class="w"> </span><span class="p">(</span><span class="nv">add-env-path</span><span class="w"> </span><span class="no">NIL</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nv">add-env-path</span><span class="w"> </span><span class="nv">pdflatex-dir</span><span class="p">)))</span>
<span class="w">    </span><span class="c1">; create files</span>
<span class="w">    </span><span class="p">(</span><span class="nb">ensure-directories-exist</span><span class="w"> </span><span class="nv">tempdir</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">with-open-file</span><span class="w"> </span><span class="p">(</span><span class="nv">filestream</span>
<span class="w">                     </span><span class="nv">lytex-file</span>
<span class="w">                     </span><span class="ss">:direction</span><span class="w"> </span><span class="ss">:output</span>
<span class="w">                     </span><span class="ss">:if-exists</span><span class="w"> </span><span class="ss">:supersede</span>
<span class="w">                     </span><span class="ss">:if-does-not-exist</span><span class="w"> </span><span class="ss">:create</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nv">generate-code</span><span class="w"> </span><span class="nv">row</span><span class="w"> </span><span class="nv">filestream</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nb">probe-file</span><span class="w"> </span><span class="nv">lytex-file</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">lytex-file</span><span class="p">)</span><span class="w"> </span><span class="s">" could not be created!"</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="s">"\; call lilypond-book - this can take awhile"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="s">"~a"</span>
<span class="w">            </span><span class="p">(</span><span class="nb">nth-value</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nv">asdf:run-shell-command</span>
<span class="w">             </span><span class="p">(</span><span class="nv">double-tilde</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="nv">lilybook</span><span class="w"> </span><span class="s">" --output="</span><span class="w"> </span><span class="nv">tempdir</span><span class="w"> </span><span class="s">" --pdf "</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">lytex-file</span><span class="p">))))))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nb">probe-file</span><span class="w"> </span><span class="nv">tex-file</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">tex-file</span><span class="p">)</span><span class="w"> </span><span class="s">" could not be created!"</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="s">"\; call pdflatex"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="s">"~a"</span>
<span class="w">            </span><span class="p">(</span><span class="nb">nth-value</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nv">asdf:run-shell-command</span>
<span class="w">             </span><span class="p">(</span><span class="nv">double-tilde</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="s">"cd "</span><span class="w"> </span><span class="nv">tempdir</span><span class="w"> </span><span class="s">" ; "</span><span class="w"> </span><span class="vg">*pdflatex*</span><span class="w"> </span><span class="s">" -output-directory="</span><span class="w"> </span><span class="nv">tempdir</span><span class="w"> </span><span class="s">" "</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">tex-file</span><span class="p">))))))</span>
<span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">probe-file</span><span class="w"> </span><span class="nv">pdf-file</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="s">"~a created!"</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">pdf-file</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">pdf-file</span><span class="p">)</span><span class="w"> </span><span class="s">" could not be created!"</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="s">"\; open pdf"</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">asdf:run-shell-command</span>
<span class="w">     </span><span class="p">(</span><span class="nv">double-tilde</span><span class="w"> </span><span class="p">(</span><span class="nb">concatenate</span><span class="w"> </span><span class="ss">'string</span><span class="w"> </span><span class="s">"open "</span><span class="w"> </span><span class="p">(</span><span class="nb">namestring</span><span class="w"> </span><span class="nv">pdf-file</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">create-pdf</span><span class="w"> </span><span class="vg">*row*</span><span class="p">)</span>
</pre></div>
    </div>
    

</article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2025         <a href="mailto:frank_zalkow@web.de">Frank Zalkow</a>
            
        </footer>
</div>
</div>


            <script src="../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
